import{r as a,j as t}from"./index-CZMcSghI.js";import{a as I}from"./index-DW_MHI2K.js";const F={VITE_BASE_URL:"https://swdeep.cc"};let{VITE_BASE_URL:T}=F;const A=w=>{const{onUploadSuccess:j,onUploadFail:C}=w,[d,x]=a.useState(null),[f,h]=a.useState(""),[p,c]=a.useState(0),[m,s]=a.useState(""),[y,u]=a.useState(!1),[l,g]=a.useState(!1),b=e=>{if(s(""),!e.type.startsWith("image/")){s("请选择图片文件");return}if(e.size>5*1024*1024){s("图片大小不能超过 5MB");return}x(e);const o=new FileReader;o.onload=()=>{h(o.result)},o.readAsDataURL(e)},D=e=>{e.preventDefault(),u(!0)},S=e=>{e.preventDefault(),u(!1)},U=e=>{e.preventDefault(),u(!1);const o=e.dataTransfer.files[0];o&&b(o)},R=e=>{const o=e.target.files[0];o&&b(o)},B=async()=>{var o,v;if(!d){s("请先选择图片");return}const e=new FormData;e.append("image",d);try{g(!0);const n=await I.post(`${T}/api/images/upload`,e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:i=>{const k=Math.round(i.loaded*100/i.total);c(k)}});console.log("上传成功:",n.data),j(n.data)}catch(n){const i="上传失败: "+((v=(o=n.response)==null?void 0:o.data)==null?void 0:v.message)||n.message;s(i),C(i)}finally{g(!1),c(0)}},_=()=>{x(null),h(""),c(0),s(""),g(!1)};return t.jsxs("div",{style:r.container,children:[t.jsx("div",{style:{...r.dropzone,borderColor:y?"#2196f3":"#ccc",backgroundColor:y?"#e3f2fd":"#fafafa"},onDragOver:D,onDragLeave:S,onDrop:U,children:f?t.jsxs("div",{style:r.preview,children:[t.jsx("img",{src:f,alt:"Preview",style:r.previewImage}),t.jsx("button",{onClick:_,style:r.deleteButton,children:"×"})]}):t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"点击或拖拽图片到这里上传"}),t.jsx("input",{type:"file",accept:"image/*",onChange:R,style:r.input,id:"file-upload"}),t.jsx("label",{htmlFor:"file-upload",style:r.chooseButton,children:"选择图片"})]})}),p>0&&t.jsx("div",{style:r.progressContainer,children:t.jsx("div",{style:{...r.progressBar,width:`${p}%`}})}),m&&t.jsx("div",{style:r.error,children:m}),d&&t.jsx("button",{onClick:B,disabled:l,style:{...r.uploadButton,opacity:l?.7:1,cursor:l?"not-allowed":"pointer"},children:l?`上传中 ${p}%`:"开始上传"})]})},r={container:{maxWidth:"300px",padding:"20px",fontFamily:"Arial, sans-serif"},dropzone:{border:"2px dashed #ccc",borderRadius:"4px",padding:"20px",textAlign:"center",transition:"all 0.3s ease",cursor:"pointer"},input:{display:"none"},chooseButton:{display:"inline-block",padding:"10px 20px",backgroundColor:"#2196f3",color:"white",borderRadius:"4px",cursor:"pointer",marginTop:"10px",transition:"background-color 0.3s ease"},preview:{position:"relative",marginTop:"10px"},previewImage:{maxWidth:"100%",maxHeight:"300px",borderRadius:"4px"},deleteButton:{position:"absolute",top:"10px",right:"10px",width:"30px",height:"30px",borderRadius:"50%",backgroundColor:"#ff4444",color:"white",border:"none",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center"},progressContainer:{width:"100%",height:"10px",backgroundColor:"#f0f0f0",borderRadius:"5px",marginTop:"20px",overflow:"hidden"},progressBar:{height:"100%",backgroundColor:"#4caf50",transition:"width 0.3s ease"},error:{color:"#ff4444",marginTop:"10px",fontSize:"14px"},uploadButton:{width:"100%",padding:"12px",backgroundColor:"#2196f3",color:"white",border:"none",borderRadius:"4px",marginTop:"20px",fontSize:"16px",transition:"all 0.3s ease"}};export{A as I};
