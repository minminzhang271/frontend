import{r as s,j as o}from"./index-D92L0JGA.js";import{a as I}from"./index-DW_MHI2K.js";const P=w=>{const{onUploadSuccess:j,onUploadFail:C}=w,[d,x]=s.useState(null),[f,h]=s.useState(""),[p,c]=s.useState(0),[m,a]=s.useState(""),[y,u]=s.useState(!1),[l,g]=s.useState(!1),b=e=>{if(a(""),!e.type.startsWith("image/")){a("请选择图片文件");return}if(e.size>5*1024*1024){a("图片大小不能超过 5MB");return}x(e);const t=new FileReader;t.onload=()=>{h(t.result)},t.readAsDataURL(e)},D=e=>{e.preventDefault(),u(!0)},S=e=>{e.preventDefault(),u(!1)},U=e=>{e.preventDefault(),u(!1);const t=e.dataTransfer.files[0];t&&b(t)},k=e=>{const t=e.target.files[0];t&&b(t)},R=async()=>{var t,v;if(!d){a("请先选择图片");return}const e=new FormData;e.append("image",d);try{g(!0);const n=await I.post("http://localhost:3001/api/images/upload",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:i=>{const F=Math.round(i.loaded*100/i.total);c(F)}});console.log("上传成功:",n.data),j(n.data)}catch(n){const i="上传失败: "+((v=(t=n.response)==null?void 0:t.data)==null?void 0:v.message)||n.message;a(i),C(i)}finally{g(!1),c(0)}},B=()=>{x(null),h(""),c(0),a(""),g(!1)};return o.jsxs("div",{style:r.container,children:[o.jsx("div",{style:{...r.dropzone,borderColor:y?"#2196f3":"#ccc",backgroundColor:y?"#e3f2fd":"#fafafa"},onDragOver:D,onDragLeave:S,onDrop:U,children:f?o.jsxs("div",{style:r.preview,children:[o.jsx("img",{src:f,alt:"Preview",style:r.previewImage}),o.jsx("button",{onClick:B,style:r.deleteButton,children:"×"})]}):o.jsxs(o.Fragment,{children:[o.jsx("p",{children:"点击或拖拽图片到这里上传"}),o.jsx("input",{type:"file",accept:"image/*",onChange:k,style:r.input,id:"file-upload"}),o.jsx("label",{htmlFor:"file-upload",style:r.chooseButton,children:"选择图片"})]})}),p>0&&o.jsx("div",{style:r.progressContainer,children:o.jsx("div",{style:{...r.progressBar,width:`${p}%`}})}),m&&o.jsx("div",{style:r.error,children:m}),d&&o.jsx("button",{onClick:R,disabled:l,style:{...r.uploadButton,opacity:l?.7:1,cursor:l?"not-allowed":"pointer"},children:l?`上传中 ${p}%`:"开始上传"})]})},r={container:{maxWidth:"300px",padding:"20px",fontFamily:"Arial, sans-serif"},dropzone:{border:"2px dashed #ccc",borderRadius:"4px",padding:"20px",textAlign:"center",transition:"all 0.3s ease",cursor:"pointer"},input:{display:"none"},chooseButton:{display:"inline-block",padding:"10px 20px",backgroundColor:"#2196f3",color:"white",borderRadius:"4px",cursor:"pointer",marginTop:"10px",transition:"background-color 0.3s ease"},preview:{position:"relative",marginTop:"10px"},previewImage:{maxWidth:"100%",maxHeight:"300px",borderRadius:"4px"},deleteButton:{position:"absolute",top:"10px",right:"10px",width:"30px",height:"30px",borderRadius:"50%",backgroundColor:"#ff4444",color:"white",border:"none",cursor:"pointer",fontSize:"20px",display:"flex",alignItems:"center",justifyContent:"center"},progressContainer:{width:"100%",height:"10px",backgroundColor:"#f0f0f0",borderRadius:"5px",marginTop:"20px",overflow:"hidden"},progressBar:{height:"100%",backgroundColor:"#4caf50",transition:"width 0.3s ease"},error:{color:"#ff4444",marginTop:"10px",fontSize:"14px"},uploadButton:{width:"100%",padding:"12px",backgroundColor:"#2196f3",color:"white",border:"none",borderRadius:"4px",marginTop:"20px",fontSize:"16px",transition:"all 0.3s ease"}};export{P as I};
