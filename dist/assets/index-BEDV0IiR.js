import{j as e,u as E,r as h}from"./index-CZMcSghI.js";import{H as C,F as k}from"./index-CkQU61nK.js";import{I as D}from"./index-BMfRqOZD.js";import{g as I,a as P,h as U,m as $,b as O,c as R,f as T,E as _}from"./index-CaQzLWPe.js";import{r as i}from"./request-3_-lSy7-.js";import"./index-DW_MHI2K.js";const z={getAllPosts:a=>i.get("/api/posts",{params:a}),getCategoryPosts:a=>i.get(`/api/category/${id}/posts`,{params:a}),getDetail:a=>i.get(`/api/posts/${a}`),create:a=>i.post("/api/posts",a),update:(a,m)=>i.put(`/api/posts/${a}`,m),delete:a=>i.delete(`/api/posts/${a}`),getDrafts:()=>i.get("/api/posts/drafts"),saveDraft:a=>i.post("/api/posts/drafts",a),publish:a=>i.put(`/api/posts/${a}/publish`)},A=({value:a,onChange:m})=>{const b=[I(),P(),U(),$(),O(),R(),T()],o={hide:!1,emoji:!0,custom:[{title:"插入表格",icon:"<svg>...</svg>",handler:{type:"action",click:r=>{const s=`
                      | 表头 1 | 表头 2 |
                      | ------ | ------ |
                      | 内容 1 | 内容 2 |
            `.trim();r.replaceSelection(s)}}}]},c=r=>{if(!["image/jpeg","image/png","image/gif"].includes(r.type))throw new Error("不支持的文件类型");if(r.size>5242880)throw new Error("文件大小超出限制")},n=async r=>{try{return await Promise.all(r.map(async d=>{c(d);const p=new FormData;p.append("file",d);const g=await fetch("http://localhost:3001/api/upload",{method:"POST",body:p,headers:{}});if(!g.ok)throw new Error("Upload failed");const v=await g.json();return console.log("data.url",v.url),v.url}))}catch(s){return console.error("Upload error:",s.message),alert(s.message),[]}};return e.jsx("div",{className:"markdown-editor",children:e.jsx(_,{value:a,plugins:b,onChange:m,uploadImages:n,toolbar:o,mode:"auto",placeholder:"开始编写..."})})},H=()=>{const a=E(),[m,b]=h.useState(`---
title: 文章标题
date: ${new Date().toISOString().split("T")[0]}
tags: [标签1, 标签2]
---

# 开始写作

## Markdown 语法示例

### 1. 文本格式化
    

    
    `),[o,c]=h.useState({title:"",description:"",cover:null,content:m,category:"1",recommendation:"latest"}),[n,r]=h.useState({}),[s,d]=h.useState(!1),p=h.useRef(null),g=[{value:1,label:"AIGC"},{value:2,label:"美股"},{value:3,label:"支付"},{value:4,label:"对外汉语"},{value:5,label:"随笔"}],v=[{value:"latest",label:"最新发布"},{value:"homepage",label:"首页推荐"},{value:"popular",label:"热门文章"},{value:"trending",label:"趋势话题"},{value:"editor_pick",label:"编辑精选"},{value:"none",label:"不推广"}],f=()=>{const t={};return o.title.trim()?o.title.length>100&&(t.title="标题不能超过100个字符"):t.title="请输入标题",o.category||(t.category="请选择分类"),o.content.trim()||(t.content="请输入内容"),r(t),Object.keys(t).length===0},u=t=>{const{name:l,value:x}=t.target;console.log("name",l,x,typeof x),c(j=>({...j,[l]:x})),r(j=>({...j,[l]:void 0}))},y=t=>{c(l=>({...l,content:t})),r(l=>({...l,content:void 0}))},w=async t=>{if(t.preventDefault(),!!f()){d(!0);try{console.log("提交的表单数据:",{...o});const l=await z.create({...o});console.log("response",l),a("/post/"+l.id),alert("发布成功！")}catch(l){console.log("发布失败error",l),alert("发布失败，请重试")}finally{d(!1)}}},N=()=>{var t;c({title:"1",category:"",cover:null,recommendation:"latest",content:""}),setImagePreview(""),r({}),(t=p.current)==null||t.reset()},F=t=>{console.log("上传成功:",t.data),c(l=>({...l,cover:t.data}))},S=async t=>{console.log("上传失败:",t)};return e.jsxs("div",{className:"post-form-container",children:[e.jsx("h1",{className:"form-title",children:"发布新博客"}),e.jsxs("form",{ref:p,onSubmit:w,className:`post-form ${s?"loading":""}`,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"标题"}),e.jsx("input",{type:"text",id:"title",name:"title",value:o.title,onChange:u,placeholder:"请输入博客标题",disabled:s}),n.title&&e.jsx("span",{className:"error-message",children:n.title})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"描述"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:o.description,onChange:u,placeholder:"请输入描述",disabled:s})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"分类"}),e.jsxs("select",{id:"category",name:"category",value:o.category,onChange:u,disabled:s,children:[e.jsx("option",{value:"",children:"选择分类"}),g.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),n.category&&e.jsx("span",{className:"error-message",children:n.category})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cover",children:"封面图片"}),e.jsx("input",{type:"hidden",id:"cover",name:"cover",value:o.cover||""}),e.jsx(D,{onUploadSuccess:F,onUploadFail:S}),n.cover&&e.jsx("span",{className:"error-message",children:n.cover})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"recommendation",children:"选择推广方式"}),e.jsx("select",{id:"recommendation",name:"recommendation",value:o.recommendation,onChange:u,disabled:s,children:v.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"content",children:"内容"}),e.jsx("textarea",{id:"content",name:"content",value:o.content,onChange:u,placeholder:"请输入博客内容",rows:10,disabled:s}),e.jsx(A,{value:o.content,onChange:y}),n.content&&e.jsx("span",{className:"error-message",children:n.content})]}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{type:"submit",className:"submit-button",disabled:s,children:s?"发布中":"发布博客"}),e.jsx("button",{type:"button",className:"submit-button reset-button",onClick:N,disabled:s,children:"重置"})]})]})]})},L="_container_31r8k_1",M={container:L};function Q(){return e.jsxs("div",{children:[e.jsx(C,{}),e.jsx("div",{className:M.container,children:e.jsx(H,{})}),e.jsx(k,{})]})}export{Q as default};
